<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aramco Digital SlideMaker â€¢ Welcome</title>
  <link rel="stylesheet" href="./css/welcome.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="./scripts/database.js"></script>
  <style>
    /* Phase 1: Trebuchet font for all text */
    * {
      font-family: 'Trebuchet MS', 'Lucida Grande', 'Lucida Sans Unicode', 'Lucida Sans', Tahoma, sans-serif !important;
    }
  </style>
</head>
<body>
  <!-- Gradient Shimmer Overlay -->
  <div class="gradient-shimmer"></div>
  
  <!-- Floating Stars Background -->
  <div class="stars-background">
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
  </div>

  <!-- Floating Particles -->
  <div class="particles-container">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>

  <!-- Micro-Particles Floating Slowly -->
  <div class="micro-particles">
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
    <div class="micro-particle"></div>
  </div>

  <!-- Mountain Background -->
  <div class="mountains-container">
    <img src="./assets/backgrounds/mountains.svg" alt="Mountain Background" class="mountains-svg">
  </div>

  <!-- Top Navigation Bar -->
  <nav class="top-nav" id="topNav">
    <img src="./CURSOR-Project/public/aramco-digital.O&D.PNG" alt="Aramco Digital Logo" class="nav-logo">
    <ul class="nav-links">
      <li><a href="#about">About</a></li>
      <li>
        <button class="nav-signup-btn" onclick="window.location.href='./index.html'">
          Sign Up
        </button>
      </li>
    </ul>
  </nav>

  <!-- Hero Section -->
  <main class="hero-container">
    <div class="hero-card">
      <h1 class="hero-title">Welcome</h1>
      <p class="hero-subtitle">
        Create stunning presentations, collaborate with your team, and bring your ideas to life with Aramco Digital SlideMaker.
      </p>
      <button class="hero-cta" id="getStartedBtn" onclick="handleGetStarted()">
        <span class="cta-text">Get Started</span>
        <i class="fas fa-arrow-right cta-arrow"></i>
      </button>
    </div>
  </main>

  <script>
    // Phase 1: Auto-login check - skip access page if already logged in
    function checkAutoLogin() {
      // First, check if user is already logged in (currentUser exists)
      const currentUserStr = localStorage.getItem('currentUser');
      if (currentUserStr) {
        try {
          const currentUser = JSON.parse(currentUserStr);
          if (currentUser && (currentUser.userID || currentUser.email)) {
            // User is already logged in - skip Access Page and go directly to Home
            window.location.href = './Home.html';
            return true;
          }
        } catch (e) {
          console.warn('Error parsing currentUser:', e);
        }
      }

      // Second, check for deviceToken for auto-login
      const deviceToken = localStorage.getItem('deviceToken');
      
      if (deviceToken && typeof Database !== 'undefined') {
        // Find user by deviceToken
        const user = Database.getUserByDeviceToken(deviceToken);
        
        if (user) {
          // User found with valid deviceToken - skip Access Page
          // Set current user and go directly to Home
          const currentUserData = {
            userID: user.userID,
            fullName: user.fullName,
            email: user.email,
            username: user.fullName || user.email
          };
          
          localStorage.setItem('currentUser', JSON.stringify(currentUserData));
          localStorage.removeItem('guest');
          
          // Load recents, templates, groups
          // Then redirect to Home
          window.location.href = './Home.html';
          return true;
        }
      }
      
      return false;
    }

    // Handle Get Started button click
    function handleGetStarted() {
      // Check if user is already logged in or has deviceToken
      if (!checkAutoLogin()) {
        // No current user or deviceToken - go to Access Page
        window.location.href = './index.html';
      }
      // If checkAutoLogin() returns true, it will redirect to Home.html automatically
    }

    // Check auto-login on page load
    document.addEventListener('DOMContentLoaded', () => {
      // Small delay to ensure Database is initialized
      setTimeout(() => {
        checkAutoLogin();
      }, 100);
    });

    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
  </script>
  
  <!-- Performance Optimization -->
  <script src="./scripts/performance.js"></script>
</body>
</html>
